<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3d Model.js</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div>
        <select class="colorSelector" name="colorSelector">
            <option value="0xf0161d">RED</option>
            <option value="0x1a99ed">BLUE</option>
            <option value="0xb0f573">GREEN</option>
            <option value="0x262626">BLACK</option>
        </select>
    </div>


    <script src="threeFiles/three.js"></script>
    <script src="threeFiles/OBJLoader.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>



    <script>
        let container;
        let camera, scene, renderer;

        init();
        animate();

        let objectLogo;


        function init() {
            // canvas 
            container = document.createElement('div');
            document.body.appendChild(container);

            // camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 10000);
            //camera.position.z = 600;
            camera.position.y = 50;
            camera.position.x = 100;

            // scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xffffff);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xffffff, 1);
            pointLight.position.set(50, 50, 50);
            camera.add(pointLight);

            scene.add(camera);


            // CHAPA OBJECT
            // texture CHAPA
            //const textureLoaderBase = new THREE.TextureLoader();
            //const textureBase = textureLoaderBase.load('granulado.jpg');

            // model loader CHAPA
            let objectChapa;
            const loaderChapa = new THREE.OBJLoader();
            loaderChapa.load('piezas/CHAPA.obj', function (objChapa) {
                objectChapa = objChapa;

                objectChapa.traverse(function (child) {
                    if (child.isMesh) {
                        // add color
                        child.material.color.setHex(0x8b5ee6);
                        // add texture
                        //child.material.map = textureBase;
                    }
                });
                objectChapa.position.y = 1;
                objectChapa.rotation.x = -Math.PI / 2;
                objectChapa.rotation.z = -0.25 * Math.PI;
                console.log("Chapa", objectChapa.position)
                scene.add(objectChapa);
            }, onProgress, onError);


            // LOGO OBJECT
            // model loader LOGO
            const loaderLogo = new THREE.OBJLoader();
            loaderLogo.load('piezas/GREENDED.obj', function (objLogo) {
                objectLogo = objLogo;

                objectLogo.traverse(function (child) {
                    if (child.isMesh) {
                        // add color
                        child.material.color.setHex(0x262626);
                        // add texture
                        //child.material.map = textureBase;
                    }
                });
                objectLogo.position.y = 1;
                objectLogo.rotation.x = -Math.PI / 2;
                objectLogo.rotation.z = (0.75 * Math.PI);
                console.log("Logo", objectLogo.position)
                scene.add(objectLogo);
            }, onProgress, onError);



            // BASE OBJECT
            // model loader BASE
            let objectBase;
            const loaderBase = new THREE.OBJLoader();
            loaderBase.load('piezas/GALLETA BASE V2.obj', function (objBase) {
                objectBase = objBase;

                objectBase.traverse(function (child) {
                    if (child.isMesh) {
                        // add color
                        child.material.color.setHex(0x8b5ee6);
                        // add texture
                        //child.material.map = textureBase;
                    }
                });

                //objectBase.position.y = - 100;
                console.log("Base", objectBase.position)
                scene.add(objectBase);
            }, onProgress, onError);

            // TAPA OBJECT
            // model loader TAPA
            let objectTapa;
            const loaderTapa = new THREE.OBJLoader();
            loaderTapa.load('piezas/GALLETA TAPA V1.obj', function (objBase) {
                objectTapa = objBase;

                objectTapa.traverse(function (child) {
                    if (child.isMesh) {
                        child.material.color.setHex(0x262626);
                    }
                });

                //objectTapa.position.y = - 100;
                console.log("Tapa", objectTapa.position)
                scene.add(objectTapa);
            }, onProgress, onError);

            // update colors
            const selectElement = document.querySelector('.colorSelector');

            selectElement.addEventListener('change', (event) => {
                objectTapa.traverse(function (child) {
                    if (child.isMesh) {
                        child.material.color.setHex(event.target.value);
                    }
                });
            });




            // renderer
            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableZoom = true;


            // resize window
            window.addEventListener('resize', onWindowResize);

            // model
            function onProgress(xhr) {
                if (xhr.lengthComputable) {
                    const percentComplete = xhr.loaded / xhr.total * 100;
                    console.log('model ' + Math.round(percentComplete, 2) + '% downloaded');
                }
            }

            function onError() { }
        }




        function onWindowResize() {
            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();


            render();
        }

        function render() {
            camera.lookAt(scene.position);
            renderer.render(scene, camera);
        }

    </script>


</body>

</html>